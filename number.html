<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>填数游戏</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #e0f7fa;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            padding: 20px;
        }
        
        h1 {
            color: #00796b;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .timer {
            font-size: 1.2em;
            color: #00796b;
            margin-bottom: 20px;
        }
        
        .board {
            display: grid;
            grid-template-columns: repeat(3, 80px);
            grid-template-rows: repeat(3, 80px);
            gap: 5px;
            margin-bottom: 20px;
        }
        
        .cell {
            width: 80px;
            height: 80px;
            border: 2px solid #00796b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            cursor: pointer;
            background-color: #b2ebf2;
            transition: background-color 0.3s;
        }
        
        .cell:hover {
            background-color: #80deea;
        }
        
        .cell.selected {
            background-color: #4dd0e1;
        }
        
        .cell.computer {
            color: #d32f2f;
        }
        
        .cell.error {
            border: 3px solid #f44336;
            animation: shake 0.5s;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .number-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .number-button {
            width: 60px;
            height: 60px;
            font-size: 1.5em;
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .number-button:hover {
            background-color: #00897b;
        }
        
        .control-buttons {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        
        .control-button {
            padding: 10px 20px;
            font-size: 1em;
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .control-button:hover {
            background-color: #00897b;
        }
        
        .message {
            margin-top: 20px;
            font-size: 1.2em;
            color: #00796b;
            height: 30px;
        }
        
        .start-button {
            padding: 10px 30px;
            font-size: 1.2em;
            background-color: #00796b;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 20px;
        }
        
        .start-button:hover {
            background-color: #00897b;
        }
    </style>
</head>
<body>
    <h1>填数游戏</h1>
    <button class="start-button">开始游戏</button>
    <div class="timer">用时: 00:00</div>
    <div class="board" id="board"></div>
    <div class="number-buttons">
        <button class="number-button" data-number="1">1</button>
        <button class="number-button" data-number="2">2</button>
        <button class="number-button" data-number="3">3</button>
    </div>
    <div class="control-buttons">
        <button class="control-button" id="check-button">检查</button>
    </div>
    <div class="message" id="message"></div>

    <script>
        const board = document.getElementById('board');
        const numberButtons = document.querySelectorAll('.number-button');
        const checkButton = document.getElementById('check-button');
        const messageElement = document.getElementById('message');
        const timerElement = document.querySelector('.timer');
        const startButton = document.querySelector('.start-button');
        
        let selectedCell = null;
        let cells = [];
        let gameBoard = Array(3).fill().map(() => Array(3).fill(0));
        let isPlayerTurn = true;
        let gameActive = false;
        let startTime = 0;
        let timerInterval = null;
        
        // 初始化游戏板
        function initializeBoard() {
            board.innerHTML = '';
            cells = [];
            gameBoard = Array(3).fill().map(() => Array(3).fill(0));
            
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener('click', () => selectCell(cell, i, j));
                    board.appendChild(cell);
                    cells.push(cell);
                }
            }
        }
        
        // 选择单元格
        function selectCell(cell, row, col) {
            if (!gameActive || !isPlayerTurn || gameBoard[row][col] !== 0) return;
            
            // 取消之前的选择
            if (selectedCell) {
                selectedCell.classList.remove('selected');
            }
            
            // 选择新单元格
            selectedCell = cell;
            selectedCell.classList.add('selected');
        }
        
        // 填充数字
        function fillNumber(number) {
            if (!gameActive || !isPlayerTurn || !selectedCell) return;
            
            const row = parseInt(selectedCell.dataset.row);
            const col = parseInt(selectedCell.dataset.col);
            
            // 填充玩家选择的数字
            gameBoard[row][col] = number;
            selectedCell.textContent = number;
            selectedCell.classList.remove('selected');
            selectedCell = null;
            
            isPlayerTurn = false;
            
            // 电脑自动填充
            setTimeout(computerMove, 500);
        }
        
        // 电脑移动
        function computerMove() {
            if (!gameActive) return;
            
            // 找出所有空单元格
            const emptyCells = [];
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (gameBoard[i][j] === 0) {
                        emptyCells.push({row: i, col: j});
                    }
                }
            }
            
            if (emptyCells.length === 0) {
                isPlayerTurn = true;
                return;
            }
            
            // 尝试为每个空单元格找到可能的数字
            for (const cell of emptyCells) {
                const possibleNumbers = findPossibleNumbers(cell.row, cell.col);
                
                if (possibleNumbers.length === 1) {
                    // 只有一个可能的数字，电脑填充它
                    gameBoard[cell.row][cell.col] = possibleNumbers[0];
                    const cellElement = document.querySelector(`.cell[data-row="${cell.row}"][data-col="${cell.col}"]`);
                    cellElement.textContent = possibleNumbers[0];
                    cellElement.classList.add('computer');
                    
                    // 检查游戏是否结束
                    if (isBoardFull()) {
                        gameActive = false;
                        clearInterval(timerInterval);
                    }
                    
                    isPlayerTurn = true;
                    return;
                }
            }
            
            // 如果没有确定的数字，随机选择一个空单元格填充可能的数字
            const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
            const possibleNumbers = findPossibleNumbers(randomCell.row, randomCell.col);
            
            if (possibleNumbers.length > 0) {
                const randomNumber = possibleNumbers[Math.floor(Math.random() * possibleNumbers.length)];
                gameBoard[randomCell.row][randomCell.col] = randomNumber;
                const cellElement = document.querySelector(`.cell[data-row="${randomCell.row}"][data-col="${randomCell.col}"]`);
                cellElement.textContent = randomNumber;
                cellElement.classList.add('computer');
            }
            
            // 检查游戏是否结束
            if (isBoardFull()) {
                gameActive = false;
                clearInterval(timerInterval);
            }
            
            isPlayerTurn = true;
        }
        
        // 查找可能的数字
        function findPossibleNumbers(row, col) {
            const usedNumbers = new Set();
            
            // 检查行
            for (let j = 0; j < 3; j++) {
                if (gameBoard[row][j] !== 0) {
                    usedNumbers.add(gameBoard[row][j]);
                }
            }
            
            // 检查列
            for (let i = 0; i < 3; i++) {
                if (gameBoard[i][col] !== 0) {
                    usedNumbers.add(gameBoard[i][col]);
                }
            }
            
            // 返回未使用的数字
            const possibleNumbers = [];
            for (let num = 1; num <= 3; num++) {
                if (!usedNumbers.has(num)) {
                    possibleNumbers.push(num);
                }
            }
            
            return possibleNumbers;
        }
        
        // 检查游戏板是否已满
        function isBoardFull() {
            for (let i = 0; i < 3; i++) {
                for (let j = 0; j < 3; j++) {
                    if (gameBoard[i][j] === 0) {
                        return false;
                    }
                }
            }
            return true;
        }
        
        // 检查游戏结果
        function checkResult() {
            if (!gameActive) return;
            
            let isValid = true;
            const errorCells = [];
            
            // 检查行
            for (let i = 0; i < 3; i++) {
                const rowSet = new Set();
                for (let j = 0; j < 3; j++) {
                    if (gameBoard[i][j] === 0) {
                        isValid = false;
                        continue;
                    }
                    if (rowSet.has(gameBoard[i][j])) {
                        isValid = false;
                        // 标记重复的数字
                        for (let k = 0; k < 3; k++) {
                            if (gameBoard[i][k] === gameBoard[i][j]) {
                                errorCells.push([i, k]);
                            }
                        }
                    }
                    rowSet.add(gameBoard[i][j]);
                }
            }
            
            // 检查列
            for (let j = 0; j < 3; j++) {
                const colSet = new Set();
                for (let i = 0; i < 3; i++) {
                    if (gameBoard[i][j] === 0) {
                        isValid = false;
                        continue;
                    }
                    if (colSet.has(gameBoard[i][j])) {
                        isValid = false;
                        // 标记重复的数字
                        for (let k = 0; k < 3; k++) {
                            if (gameBoard[k][j] === gameBoard[i][j]) {
                                errorCells.push([k, j]);
                            }
                        }
                    }
                    colSet.add(gameBoard[i][j]);
                }
            }
            
            // 标记错误的单元格
            cells.forEach(cell => cell.classList.remove('error'));
            const uniqueErrorCells = Array.from(new Set(errorCells.map(JSON.stringify))).map(JSON.parse);
            
            uniqueErrorCells.forEach(([row, col]) => {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                cell.classList.add('error');
            });
            
            // 显示结果
            if (isValid) {
                gameActive = false;
                clearInterval(timerInterval);
                messageElement.textContent = "恭喜你，挑战成功";
                speak("恭喜你，挑战成功");
            } else {
                messageElement.textContent = "横竖要排除哦，加油";
                speak("横竖要排除哦，加油");
            }
        }
        
        // 语音播报
        function speak(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                speechSynthesis.speak(utterance);
            }
        }
        
        // 更新计时器
        function updateTimer() {
            const currentTime = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(currentTime / 60).toString().padStart(2, '0');
            const seconds = (currentTime % 60).toString().padStart(2, '0');
            timerElement.textContent = `用时: ${minutes}:${seconds}`;
        }
        
        // 开始游戏
        function startGame() {
            initializeBoard();
            gameActive = true;
            isPlayerTurn = true;
            selectedCell = null;
            messageElement.textContent = '';
            
            // 重置计时器
            clearInterval(timerInterval);
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
        }
        
        // 事件监听
        numberButtons.forEach(button => {
            button.addEventListener('click', () => {
                const number = parseInt(button.dataset.number);
                fillNumber(number);
            });
        });
        
        checkButton.addEventListener('click', checkResult);
        startButton.addEventListener('click', startGame);
        
        // 初始化游戏
        initializeBoard();
    </script>
</body>
</html>